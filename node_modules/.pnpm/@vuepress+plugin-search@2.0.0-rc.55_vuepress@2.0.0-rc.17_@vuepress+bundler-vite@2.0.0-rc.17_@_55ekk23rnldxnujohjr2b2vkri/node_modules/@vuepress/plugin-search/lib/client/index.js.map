{"version":3,"file":"index.js","sources":["../../src/client/utils/isFocusingTextControl.ts","../../src/client/utils/isKeyMatched.ts","../../src/client/utils/isQueryMatched.ts","../../src/client/composables/useHotKeys.ts","../../src/client/composables/useSearchIndex.ts","../../src/client/composables/useSearchSuggestions.ts","../../src/client/composables/useSuggestionsFocus.ts","../../src/client/components/SearchBox.ts"],"sourcesContent":["/**\n * Determines whether the user is currently focusing a text control.\n * In this case, the search plugin shouldnâ€™t hijack any hotkeys because\n * the user might be typing into a text field, using type-ahead search\n * in a `select` element, etc.\n */\nexport const isFocusingTextControl = (target: EventTarget): boolean => {\n  if (!(target instanceof Element)) {\n    return false\n  }\n  return (\n    document.activeElement === target &&\n    (['TEXTAREA', 'SELECT', 'INPUT'].includes(target.tagName) ||\n      target.hasAttribute('contenteditable'))\n  )\n}\n","import { isString } from 'vuepress/shared'\nimport type { HotKeyOptions } from '../../shared/index.js'\n\nexport const isKeyMatched = (\n  event: KeyboardEvent,\n  hotKeys: (HotKeyOptions | string)[],\n): boolean =>\n  hotKeys.some((item) => {\n    if (isString(item)) {\n      return item === event.key\n    }\n\n    const { key, ctrl = false, shift = false, alt = false } = item\n    return (\n      key === event.key &&\n      ctrl === event.ctrlKey &&\n      shift === event.shiftKey &&\n      alt === event.altKey\n    )\n  })\n","// eslint-disable-next-line no-control-regex\nconst nonASCIIRegExp = /[^\\x00-\\x7F]/\n\nconst splitWords = (content: string): string[] =>\n  content\n    .split(/\\s+/g)\n    .map((str) => str.trim())\n    .filter((str) => !!str)\n\nconst escapeRegExp = (str: string): string =>\n  str.replace(/[-/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&')\n\nexport const isQueryMatched = (query: string, toMatch: string[]): boolean => {\n  const toMatchStr = toMatch.join(' ')\n  const words = splitWords(query)\n\n  if (nonASCIIRegExp.test(query)) {\n    // if the query has non-ASCII chars, treat as other languages\n    return words.some((word) => toMatchStr.toLowerCase().includes(word))\n  }\n\n  // if the query only has ASCII chars, treat as English\n  const hasTrailingSpace = query.endsWith(' ')\n  const searchRegex = new RegExp(\n    `${words\n      .map((word, index) => {\n        if (words.length === index + 1 && !hasTrailingSpace) {\n          // The last word - ok with the word being \"startsWith\"-like\n          return `(?=.*\\\\b${escapeRegExp(word)})`\n        }\n        // Not the last word - expect the whole word exactly\n        return `(?=.*\\\\b${escapeRegExp(word)}\\\\b)`\n      })\n      .join('')}.+`,\n    'gi',\n  )\n  return searchRegex.test(toMatchStr)\n}\n","import type { Ref } from 'vue'\nimport { onBeforeUnmount, onMounted } from 'vue'\nimport type { HotKeyOptions } from '../../shared/index.js'\nimport { isFocusingTextControl, isKeyMatched } from '../utils/index.js'\n\nexport const useHotKeys = ({\n  input,\n  hotKeys,\n}: {\n  input: Ref<HTMLInputElement | null>\n  hotKeys: Ref<(HotKeyOptions | string)[]>\n}): void => {\n  if (hotKeys.value.length === 0) return\n\n  const onKeydown = (event: KeyboardEvent): void => {\n    if (!input.value) return\n    if (\n      // key matches\n      isKeyMatched(event, hotKeys.value) &&\n      // event does not come from the search box itself or\n      // user isn't focusing (and thus perhaps typing in) a text control\n      !isFocusingTextControl(event.target!)\n    ) {\n      event.preventDefault()\n      input.value.focus()\n    }\n  }\n\n  onMounted(() => {\n    document.addEventListener('keydown', onKeydown)\n  })\n\n  onBeforeUnmount(() => {\n    document.removeEventListener('keydown', onKeydown)\n  })\n}\n","import { SEARCH_INDEX } from '@internal/searchIndex'\nimport type { Ref } from 'vue'\nimport { ref } from 'vue'\nimport type { SearchIndex } from '../../shared/index.js'\n\nexport type SearchIndexRef = Ref<SearchIndex>\n\nexport const searchIndex = ref(SEARCH_INDEX)\n\nexport const useSearchIndex = (): SearchIndexRef => searchIndex\n\nif (__VUEPRESS_DEV__ && (import.meta.webpackHot || import.meta.hot)) {\n  __VUE_HMR_RUNTIME__.updateSearchIndex = (data: SearchIndex) => {\n    searchIndex.value = data\n  }\n}\n","import type { ComputedRef, Ref } from 'vue'\nimport { computed } from 'vue'\nimport type { PageHeader } from 'vuepress/shared'\nimport type { SearchIndex, SearchIndexItem } from '../../shared/index.js'\nimport { isQueryMatched } from '../utils/index.js'\n\nexport interface SearchSuggestion {\n  link: string\n  title: string\n  header?: string\n}\n\nexport const useSearchSuggestions = ({\n  searchIndex,\n  routeLocale,\n  query,\n  maxSuggestions,\n}: {\n  searchIndex: Ref<SearchIndex>\n  routeLocale: Ref<string>\n  query: Ref<string>\n  maxSuggestions: Ref<number>\n}): ComputedRef<SearchSuggestion[]> => {\n  // filter search index of current locale\n  const localeSearchIndex = computed(() =>\n    searchIndex.value.filter((item) => item.pathLocale === routeLocale.value),\n  )\n\n  return computed(() => {\n    const searchStr = query.value.trim().toLowerCase()\n    if (!searchStr) return []\n\n    const suggestions: SearchSuggestion[] = []\n\n    const matchPageHeader = (\n      searchIndexItem: SearchIndexItem,\n      header: PageHeader,\n    ): void => {\n      if (isQueryMatched(searchStr, [header.title])) {\n        suggestions.push({\n          link: `${searchIndexItem.path}#${header.slug}`,\n          title: searchIndexItem.title,\n          header: header.title,\n        })\n      }\n\n      for (const child of header.children) {\n        if (suggestions.length >= maxSuggestions.value) {\n          return\n        }\n\n        matchPageHeader(searchIndexItem, child)\n      }\n    }\n\n    for (const searchIndexItem of localeSearchIndex.value) {\n      if (suggestions.length >= maxSuggestions.value) {\n        break\n      }\n\n      // match page title and extra fields\n      if (\n        isQueryMatched(searchStr, [\n          searchIndexItem.title,\n          ...searchIndexItem.extraFields,\n        ])\n      ) {\n        suggestions.push({\n          link: searchIndexItem.path,\n          title: searchIndexItem.title,\n        })\n        continue\n      }\n\n      // match page headers\n      for (const header of searchIndexItem.headers) {\n        if (suggestions.length >= maxSuggestions.value) {\n          break\n        }\n\n        matchPageHeader(searchIndexItem, header)\n      }\n    }\n\n    return suggestions\n  })\n}\n","import type { Ref } from 'vue'\nimport { ref } from 'vue'\n\nexport const useSuggestionsFocus = (\n  suggestions: Ref<unknown[]>,\n): {\n  focusIndex: Ref<number>\n  focusNext: () => void\n  focusPrev: () => void\n} => {\n  const focusIndex = ref(0)\n  const focusNext = (): void => {\n    if (focusIndex.value < suggestions.value.length - 1) {\n      focusIndex.value += 1\n    } else {\n      focusIndex.value = 0\n    }\n  }\n  const focusPrev = (): void => {\n    if (focusIndex.value > 0) {\n      focusIndex.value -= 1\n    } else {\n      focusIndex.value = suggestions.value.length - 1\n    }\n  }\n\n  return {\n    focusIndex,\n    focusNext,\n    focusPrev,\n  }\n}\n","import type { PropType } from 'vue'\nimport { computed, defineComponent, h, ref, toRefs } from 'vue'\nimport { useRouteLocale, useRouter } from 'vuepress/client'\nimport type { LocaleConfig } from 'vuepress/shared'\nimport type { HotKeyOptions } from '../../shared/index.js'\nimport type { SearchSuggestion } from '../composables/index.js'\nimport {\n  useHotKeys,\n  useSearchIndex,\n  useSearchSuggestions,\n  useSuggestionsFocus,\n} from '../composables/index.js'\n\nexport type SearchBoxLocales = LocaleConfig<{\n  placeholder: string\n}>\n\nexport const SearchBox = defineComponent({\n  name: 'SearchBox',\n\n  props: {\n    locales: {\n      type: Object as PropType<SearchBoxLocales>,\n      default: () => ({}),\n    },\n\n    hotKeys: {\n      type: Array as PropType<(HotKeyOptions | string)[]>,\n      default: () => [],\n    },\n\n    maxSuggestions: {\n      type: Number,\n      default: 5,\n    },\n  },\n\n  setup(props) {\n    const { locales, hotKeys, maxSuggestions } = toRefs(props)\n\n    const router = useRouter()\n    const routeLocale = useRouteLocale()\n    const searchIndex = useSearchIndex()\n\n    const input = ref<HTMLInputElement | null>(null)\n    const isActive = ref(false)\n    const query = ref('')\n    const locale = computed(() => locales.value[routeLocale.value] ?? {})\n\n    const suggestions = useSearchSuggestions({\n      searchIndex,\n      routeLocale,\n      query,\n      maxSuggestions,\n    })\n    const { focusIndex, focusNext, focusPrev } =\n      useSuggestionsFocus(suggestions)\n    useHotKeys({ input, hotKeys })\n\n    const showSuggestions = computed(\n      () => isActive.value && !!suggestions.value.length,\n    )\n    const onArrowUp = (): void => {\n      if (!showSuggestions.value) {\n        return\n      }\n      focusPrev()\n    }\n    const onArrowDown = (): void => {\n      if (!showSuggestions.value) {\n        return\n      }\n      focusNext()\n    }\n    const goTo = (index: number): void => {\n      if (!showSuggestions.value) {\n        return\n      }\n\n      const suggestion = suggestions.value[index] as\n        | SearchSuggestion\n        | undefined\n\n      if (suggestion)\n        void router.push(suggestion.link).then(() => {\n          query.value = ''\n          focusIndex.value = 0\n        })\n    }\n\n    return () =>\n      h(\n        'form',\n        {\n          class: 'search-box',\n          role: 'search',\n        },\n        [\n          h('input', {\n            ref: input,\n            type: 'search',\n            placeholder: locale.value.placeholder,\n            autocomplete: 'off',\n            spellcheck: false,\n            value: query.value,\n            onFocus: () => {\n              isActive.value = true\n            },\n            onBlur: () => {\n              isActive.value = false\n            },\n            onInput: (event) => {\n              query.value = (event.target as HTMLInputElement).value\n            },\n            onKeydown: (event) => {\n              switch (event.key) {\n                case 'ArrowUp': {\n                  onArrowUp()\n                  break\n                }\n                case 'ArrowDown': {\n                  onArrowDown()\n                  break\n                }\n                case 'Enter': {\n                  event.preventDefault()\n                  goTo(focusIndex.value)\n                  break\n                }\n                default: {\n                  // do nothing\n                }\n              }\n            },\n          }),\n          showSuggestions.value &&\n            h(\n              'ul',\n              {\n                class: 'suggestions',\n                onMouseleave: () => {\n                  focusIndex.value = -1\n                },\n              },\n              suggestions.value.map(({ link, title, header }, index) =>\n                h(\n                  'li',\n                  {\n                    class: [\n                      'suggestion',\n                      {\n                        focus: focusIndex.value === index,\n                      },\n                    ],\n                    onMouseenter: () => {\n                      focusIndex.value = index\n                    },\n                    onMousedown: () => {\n                      goTo(index)\n                    },\n                  },\n                  h(\n                    'a',\n                    {\n                      href: link,\n                      onClick: (event) => {\n                        event.preventDefault()\n                      },\n                    },\n                    [\n                      h(\n                        'span',\n                        {\n                          class: 'page-title',\n                        },\n                        title,\n                      ),\n                      header &&\n                        h('span', { class: 'page-header' }, `> ${header}`),\n                    ],\n                  ),\n                ),\n              ),\n            ),\n        ],\n      )\n  },\n})\n"],"names":["isFocusingTextControl","target","isKeyMatched","event","hotKeys","item","isString","key","ctrl","shift","alt","nonASCIIRegExp","splitWords","content","str","escapeRegExp","isQueryMatched","query","toMatch","toMatchStr","words","word","hasTrailingSpace","index","useHotKeys","input","onKeydown","onMounted","onBeforeUnmount","searchIndex","ref","SEARCH_INDEX","useSearchIndex","data","useSearchSuggestions","routeLocale","maxSuggestions","localeSearchIndex","computed","searchStr","suggestions","matchPageHeader","searchIndexItem","header","child","useSuggestionsFocus","focusIndex","SearchBox","defineComponent","props","locales","toRefs","router","useRouter","useRouteLocale","isActive","locale","focusNext","focusPrev","showSuggestions","onArrowUp","onArrowDown","goTo","suggestion","h","link","title"],"mappings":"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"}