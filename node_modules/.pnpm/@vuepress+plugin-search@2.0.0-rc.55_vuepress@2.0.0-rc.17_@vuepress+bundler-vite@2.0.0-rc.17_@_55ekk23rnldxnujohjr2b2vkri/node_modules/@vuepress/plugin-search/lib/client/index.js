import{onMounted as T,onBeforeUnmount as U,ref as h,computed as g,defineComponent as F,toRefs as B,h as i}from"vue";import{useRouter as H,useRouteLocale as P}from"vuepress/client";import{isString as j}from"vuepress/shared";import{SEARCH_INDEX as V}from"@internal/searchIndex";const w=e=>e instanceof Element?document.activeElement===e&&(["TEXTAREA","SELECT","INPUT"].includes(e.tagName)||e.hasAttribute("contenteditable")):!1,_=(e,t)=>t.some(u=>{if(j(u))return u===e.key;const{key:a,ctrl:c=!1,shift:o=!1,alt:s=!1}=u;return a===e.key&&c===e.ctrlKey&&o===e.shiftKey&&s===e.altKey}),q=/[^\x00-\x7F]/,X=e=>e.split(/\s+/g).map(t=>t.trim()).filter(t=>!!t),I=e=>e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),k=(e,t)=>{const u=t.join(" "),a=X(e);if(q.test(e))return a.some(o=>u.toLowerCase().includes(o));const c=e.endsWith(" ");return new RegExp(`${a.map((o,s)=>a.length===s+1&&!c?`(?=.*\\b${I(o)})`:`(?=.*\\b${I(o)}\\b)`).join("")}.+`,"gi").test(u)},K=({input:e,hotKeys:t})=>{if(t.value.length===0)return;const u=a=>{e.value&&_(a,t.value)&&!w(a.target)&&(a.preventDefault(),e.value.focus())};T(()=>{document.addEventListener("keydown",u)}),U(()=>{document.removeEventListener("keydown",u)})},E=h(V),L=()=>E;__VUEPRESS_DEV__&&(import.meta.webpackHot||import.meta.hot)&&(__VUE_HMR_RUNTIME__.updateSearchIndex=e=>{E.value=e});const R=({searchIndex:e,routeLocale:t,query:u,maxSuggestions:a})=>{const c=g(()=>e.value.filter(o=>o.pathLocale===t.value));return g(()=>{const o=u.value.trim().toLowerCase();if(!o)return[];const s=[],v=(n,l)=>{k(o,[l.title])&&s.push({link:`${n.path}#${l.slug}`,title:n.title,header:l.title});for(const y of l.children){if(s.length>=a.value)return;v(n,y)}};for(const n of c.value){if(s.length>=a.value)break;if(k(o,[n.title,...n.extraFields])){s.push({link:n.path,title:n.title});continue}for(const l of n.headers){if(s.length>=a.value)break;v(n,l)}}return s})},A=e=>{const t=h(0);return{focusIndex:t,focusNext:()=>{t.value<e.value.length-1?t.value+=1:t.value=0},focusPrev:()=>{t.value>0?t.value-=1:t.value=e.value.length-1}}},O=F({name:"SearchBox",props:{locales:{type:Object,default:()=>({})},hotKeys:{type:Array,default:()=>[]},maxSuggestions:{type:Number,default:5}},setup(e){const{locales:t,hotKeys:u,maxSuggestions:a}=B(e),c=H(),o=P(),s=L(),v=h(null),n=h(!1),l=h(""),y=g(()=>t.value[o.value]??{}),p=R({searchIndex:s,routeLocale:o,query:l,maxSuggestions:a}),{focusIndex:f,focusNext:M,focusPrev:$}=A(p);K({input:v,hotKeys:u});const d=g(()=>n.value&&!!p.value.length),C=()=>{d.value&&$()},N=()=>{d.value&&M()},S=r=>{if(!d.value)return;const m=p.value[r];m&&c.push(m.link).then(()=>{l.value="",f.value=0})};return()=>i("form",{class:"search-box",role:"search"},[i("input",{ref:v,type:"search",placeholder:y.value.placeholder,autocomplete:"off",spellcheck:!1,value:l.value,onFocus:()=>{n.value=!0},onBlur:()=>{n.value=!1},onInput:r=>{l.value=r.target.value},onKeydown:r=>{switch(r.key){case"ArrowUp":{C();break}case"ArrowDown":{N();break}case"Enter":{r.preventDefault(),S(f.value);break}}}}),d.value&&i("ul",{class:"suggestions",onMouseleave:()=>{f.value=-1}},p.value.map(({link:r,title:m,header:b},x)=>i("li",{class:["suggestion",{focus:f.value===x}],onMouseenter:()=>{f.value=x},onMousedown:()=>{S(x)}},i("a",{href:r,onClick:D=>{D.preventDefault()}},[i("span",{class:"page-title"},m),b&&i("span",{class:"page-header"},`> ${b}`)]))))])}});export{O as SearchBox,w as isFocusingTextControl,_ as isKeyMatched,k as isQueryMatched,E as searchIndex,K as useHotKeys,L as useSearchIndex,R as useSearchSuggestions,A as useSuggestionsFocus};
//# sourceMappingURL=index.js.map
