import{watch as _}from"chokidar";import{getDirname as l,path as o}from"vuepress/utils";const h=`
if (import.meta.webpackHot) {
  import.meta.webpackHot.accept()
  if (__VUE_HMR_RUNTIME__.updateSearchIndex) {
    __VUE_HMR_RUNTIME__.updateSearchIndex(searchIndex)
  }
}

if (import.meta.hot) {
  import.meta.hot.accept(({ searchIndex }) => {
    __VUE_HMR_RUNTIME__.updateSearchIndex(searchIndex)
  })
}
`,i=async({app:r,isSearchable:c,getExtraFields:p})=>{const t=r.pages.filter(c).map(e=>({title:e.title,headers:e.headers,path:e.path,pathLocale:e.pathLocale,extraFields:p(e)}));let a=`export const SEARCH_INDEX = ${JSON.stringify(t,null,2)}
`;return r.env.isDev&&(a+=h),r.writeTemp("internal/searchIndex.js",a)},d=l(import.meta.url),S=({locales:r={},hotKeys:c=["s","/"],maxSuggestions:p=5,isSearchable:t=()=>!0,getExtraFields:a=()=>[]}={})=>({name:"@vuepress/plugin-search",clientConfigFile:o.resolve(d,"../client/config.js"),define:{__SEARCH_LOCALES__:r,__SEARCH_HOT_KEYS__:c,__SEARCH_MAX_SUGGESTIONS__:p},onPrepared:async e=>{await i({app:e,isSearchable:t,getExtraFields:a})},onWatched:(e,n)=>{const s=_("pages/**/*.js",{cwd:e.dir.temp(),ignoreInitial:!0});s.on("add",()=>{i({app:e,isSearchable:t,getExtraFields:a})}),s.on("change",()=>{i({app:e,isSearchable:t,getExtraFields:a})}),s.on("unlink",()=>{i({app:e,isSearchable:t,getExtraFields:a})}),n.push(s)}});export{i as prepareSearchIndex,S as searchPlugin};
//# sourceMappingURL=index.js.map
