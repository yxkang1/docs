{"version":3,"file":"config.js","sources":["../../src/client/components/Catalog.ts","../../src/client/config.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-shadow */\nimport {\n  endsWith,\n  ensureEndingSlash,\n  ensureLeadingSlash,\n  entries,\n  isNumber,\n  isPlainObject,\n  isString,\n  keys,\n  startsWith,\n  useLocaleConfig,\n} from '@vuepress/helper/client'\nimport type { VNode } from 'vue'\nimport { computed, defineComponent, h, shallowRef } from 'vue'\nimport { RouteLink, usePageData, useRoutes, useSiteData } from 'vuepress/client'\nimport type { CatalogPluginLocaleConfig } from '../../shared/index.js'\nimport type { CatalogInfo } from '../helpers/index.js'\nimport { useCatalogInfoGetter } from '../helpers/index.js'\n\nimport '../styles/catalog.css'\n\ndeclare const __CATALOG_LOCALES__: CatalogPluginLocaleConfig\n\nexport interface CatalogProps {\n  base?: string\n  level?: 1 | 2 | 3\n}\n\ninterface CatalogData extends CatalogInfo {\n  level: number\n  base: string\n  path: string\n  children?: CatalogData[]\n}\n\nexport default defineComponent({\n  name: 'Catalog',\n\n  props: {\n    /**\n     * Catalog Base\n     *\n     * 目录的基础路径\n     *\n     * @default current route base\n     */\n    base: {\n      type: String,\n      default: '',\n    },\n\n    /**\n     * Max level of catalog\n     *\n     * @description only 1,2,3 are supported\n     *\n     * Catalog 的最大层级\n     *\n     * @description 目前仅支持 1,2,3\n     *\n     * @default 3\n     */\n    level: {\n      type: Number,\n      default: 3,\n    },\n\n    /**\n     * Whether show index for catalog\n     *\n     * 目录是否显示索引\n     */\n    index: Boolean,\n\n    /**\n     * Whether hide `Category` title\n     *\n     * 是否隐藏 `目录` 标题\n     *\n     * @default false\n     */\n    hideHeading: Boolean,\n  },\n\n  setup(props) {\n    const catalogInfoGetter = useCatalogInfoGetter()\n    const locale = useLocaleConfig(__CATALOG_LOCALES__)\n    const page = usePageData()\n    const routes = useRoutes()\n    const siteData = useSiteData()\n\n    const getCatalogData = (): CatalogData[] =>\n      entries(routes.value)\n        .map(([path, { meta }]) => {\n          const info = catalogInfoGetter(meta)\n\n          if (!info) return null\n\n          const level = path.split('/').length\n\n          return {\n            level: endsWith(path, '/') ? level - 2 : level - 1,\n            base: path.replace(/\\/[^/]+\\/?$/, '/'),\n            path,\n            ...info,\n          }\n        })\n        .filter(\n          (item): item is CatalogData =>\n            isPlainObject(item) && isString(item.title),\n        )\n\n    const catalogInfo = shallowRef(getCatalogData())\n\n    const catalogData = computed(() => {\n      const base = props.base\n        ? ensureLeadingSlash(ensureEndingSlash(props.base))\n        : page.value.path.replace(/\\/[^/]+$/, '/')\n      const baseDepth = base.split('/').length - 2\n      const result: CatalogData[] = []\n\n      catalogInfo.value\n        .filter(({ level, path }) => {\n          // filter those under current base\n          if (!startsWith(path, base) || path === base) return false\n\n          if (base === '/') {\n            const otherLocales = keys(siteData.value.locales).filter(\n              (item) => item !== '/',\n            )\n\n            // exclude 404 page and other locales\n            if (\n              path === '/404.html' ||\n              otherLocales.some((localePath) => startsWith(path, localePath))\n            )\n              return false\n          }\n\n          return (\n            // level is less than or equal to max level\n            level - baseDepth <= props.level\n          )\n        })\n        .sort(\n          (\n            { title: titleA, level: levelA, order: orderA },\n            { title: titleB, level: levelB, order: orderB },\n          ) => {\n            const level = levelA - levelB\n\n            if (level) return level\n\n            // infoA order is absent\n            if (!isNumber(orderA)) {\n              // infoB order is absent\n              if (!isNumber(orderB))\n                // compare title\n                return titleA.localeCompare(titleB)\n\n              // infoB order is present\n              return orderB\n            }\n\n            // infoB order is absent\n            if (!isNumber(orderB)) return orderA\n\n            // now we are sure both order exist\n\n            // infoA order is positive\n            if (orderA > 0) {\n              if (orderB > 0) return orderA - orderB\n\n              return -1\n            }\n\n            // both order are negative\n            if (orderB < 0) return orderA - orderB\n\n            return 1\n          },\n        )\n        .forEach((info) => {\n          const { base, level } = info\n\n          switch (level - baseDepth) {\n            case 1: {\n              result.push(info)\n              break\n            }\n\n            case 2: {\n              const parent = result.find((item) => item.path === base)\n\n              if (parent) (parent.children ??= []).push(info)\n              break\n            }\n\n            default: {\n              const grandParent = result.find(\n                (item) => item.path === base.replace(/\\/[^/]+\\/$/, '/'),\n              )\n\n              if (grandParent) {\n                const parent = grandParent.children?.find(\n                  (item) => item.path === base,\n                )\n\n                if (parent) (parent.children ??= []).push(info)\n              }\n            }\n          }\n        })\n\n      return result\n    })\n\n    return (): VNode => {\n      const isDeep = catalogData.value.some((item) => item.children)\n\n      return h('div', { class: ['vp-catalog', { index: props.index }] }, [\n        props.hideHeading\n          ? null\n          : h('h2', { class: 'vp-catalog-main-title' }, locale.value.title),\n        catalogData.value.length\n          ? h(\n              props.index ? 'ol' : 'ul',\n              { class: ['vp-catalog-list', { deep: isDeep }] },\n              catalogData.value.map(\n                ({ children = [], title, path, content }) => {\n                  const childLink = h(\n                    RouteLink,\n                    { class: 'vp-catalog-title', to: path },\n                    () => (content ? h(content) : title),\n                  )\n\n                  return h(\n                    'li',\n                    { class: 'vp-catalog-item' },\n                    isDeep\n                      ? [\n                          h(\n                            'h3',\n                            {\n                              id: title,\n                              class: [\n                                'vp-catalog-child-title',\n                                { 'has-children': children.length },\n                              ],\n                            },\n                            [\n                              h(\n                                'a',\n                                {\n                                  'href': `#${title}`,\n                                  'class': 'vp-catalog-header-anchor',\n                                  'aria-hidden': true,\n                                },\n                                '#',\n                              ),\n                              childLink,\n                            ],\n                          ),\n                          children.length\n                            ? h(\n                                props.index ? 'ol' : 'ul',\n                                { class: 'vp-child-catalogs' },\n                                children.map(\n                                  ({ children = [], content, path, title }) =>\n                                    h('li', { class: 'vp-child-catalog' }, [\n                                      h(\n                                        'div',\n                                        {\n                                          class: [\n                                            'vp-catalog-sub-title',\n                                            {\n                                              'has-children': children.length,\n                                            },\n                                          ],\n                                        },\n                                        [\n                                          h(\n                                            'a',\n                                            {\n                                              href: `#${title}`,\n                                              class: 'vp-catalog-header-anchor',\n                                            },\n                                            '#',\n                                          ),\n                                          h(\n                                            RouteLink,\n                                            {\n                                              class: 'vp-catalog-title',\n                                              to: path,\n                                            },\n                                            () =>\n                                              content ? h(content) : title,\n                                          ),\n                                        ],\n                                      ),\n                                      children.length\n                                        ? h(\n                                            props.index ? 'ol' : 'div',\n                                            {\n                                              class: props.index\n                                                ? 'vp-sub-catalogs'\n                                                : 'vp-sub-catalogs-wrapper',\n                                            },\n                                            children.map(\n                                              ({ content, path, title }) =>\n                                                props.index\n                                                  ? h(\n                                                      'li',\n                                                      {\n                                                        class: 'vp-sub-catalog',\n                                                      },\n                                                      h(\n                                                        RouteLink,\n                                                        { to: path },\n                                                        () =>\n                                                          content\n                                                            ? h(content)\n                                                            : title,\n                                                      ),\n                                                    )\n                                                  : h(\n                                                      RouteLink,\n                                                      {\n                                                        class:\n                                                          'vp-sub-catalog-link',\n                                                        to: path,\n                                                      },\n                                                      () =>\n                                                        content\n                                                          ? h(content)\n                                                          : title,\n                                                    ),\n                                            ),\n                                          )\n                                        : null,\n                                    ]),\n                                ),\n                              )\n                            : null,\n                        ]\n                      : h(\n                          'div',\n                          { class: 'vp-catalog-child-title' },\n                          childLink,\n                        ),\n                  )\n                },\n              ),\n            )\n          : h('p', { class: 'vp-empty-catalog' }, locale.value.empty),\n      ])\n    }\n  },\n})\n","import { hasGlobalComponent } from '@vuepress/helper/client'\nimport { defineClientConfig } from 'vuepress/client'\nimport Catalog from './components/Catalog.js'\nimport { injectCatalogInfoGetter } from './helpers/index.js'\n\nimport './styles/vars.css'\n\nexport default defineClientConfig({\n  enhance: ({ app }) => {\n    injectCatalogInfoGetter(app)\n    if (!hasGlobalComponent('Catalog', app)) app.component('Catalog', Catalog)\n  },\n})\n"],"names":["m","defineComponent","props","catalogInfoGetter","useCatalogInfoGetter","locale","useLocaleConfig","page","usePageData","routes","useRoutes","siteData","useSiteData","catalogInfo","shallowRef","entries","path","meta","info","level","endsWith","item","isPlainObject","isString","catalogData","computed","base","ensureLeadingSlash","ensureEndingSlash","baseDepth","result","startsWith","otherLocales","keys","localePath","titleA","levelA","orderA","titleB","levelB","orderB","isNumber","parent","grandParent","isDeep","h","children","title","content","childLink","RouteLink","config","defineClientConfig","app","injectCatalogInfoGetter","hasGlobalComponent","Catalog"],"mappings":"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"}