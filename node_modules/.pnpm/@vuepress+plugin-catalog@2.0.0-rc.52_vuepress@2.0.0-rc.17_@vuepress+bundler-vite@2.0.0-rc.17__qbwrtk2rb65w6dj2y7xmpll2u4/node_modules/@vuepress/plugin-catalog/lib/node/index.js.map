{"version":3,"file":"index.js","sources":["../../src/node/getTitleFromFilename.ts","../../src/node/logger.ts","../../src/node/generateCatalogPage.ts","../../src/node/locales.ts","../../src/node/catalogPlugin.ts"],"sourcesContent":["const EN_PREPOSITION = [\n  'and',\n  'or',\n  'in',\n  'on',\n  'with',\n  'by',\n  'for',\n  'at',\n  'about',\n  'under',\n  'of',\n  'to',\n  'the',\n  'into',\n]\n\nexport const getTitleFromFilename = (filename: string): string => {\n  const words = filename\n    .replace(/[-_]/gu, ' ')\n    .replace(\n      /(^|[^A-Z])([A-Z])/gu,\n      (_all, match1: string, match2: string) =>\n        `${match1} ${match2.toLowerCase()}`,\n    )\n    .replace(/ +/gu, ' ')\n    .trim()\n    .split(' ')\n\n  return words\n    .map((word, index) =>\n      EN_PREPOSITION.includes(word) && index !== 0\n        ? word\n        : word.charAt(0).toUpperCase() + word.slice(1),\n    )\n    .join(' ')\n}\n","import { Logger } from '@vuepress/helper'\n\nexport const PLUGIN_NAME = '@vuepress/plugin-catalog'\n\nexport const logger = new Logger(PLUGIN_NAME)\n","import type { App } from 'vuepress/core'\nimport { createPage } from 'vuepress/core'\nimport type { PageFrontmatter } from 'vuepress/shared'\nimport { getTitleFromFilename } from './getTitleFromFilename.js'\nimport { logger } from './logger.js'\nimport type { CatalogPluginOptions } from './options.js'\n\nexport const generateCatalogPage = async (\n  app: App,\n  {\n    component = 'Catalog',\n    exclude = [],\n    frontmatter = (): PageFrontmatter => ({}),\n    level = 3,\n    index = false,\n  }: CatalogPluginOptions,\n): Promise<void> => {\n  const {\n    env: { isDebug },\n    pages,\n  } = app\n\n  const pathToBeGenerated = new Set<string>()\n  const content = `\\\n<${component}${[1, 2].includes(level) ? ` :level=\"${level}\"` : ''}${\n    index ? ' index' : ''\n  }/>\n`\n\n  pages.forEach(({ path: pagePath, pathLocale }) => {\n    let catalogPath = pagePath\n\n    // not 404 page\n    if (pagePath !== '/404.html')\n      while (catalogPath !== pathLocale) {\n        catalogPath = catalogPath.replace(/\\/(?:[^/]+\\/?)$/, '/')\n\n        if (\n          // not discovered yet\n          !pathToBeGenerated.has(catalogPath) &&\n          // not being excluded\n          // eslint-disable-next-line @typescript-eslint/no-loop-func\n          exclude.every((pattern) => !catalogPath.match(pattern)) &&\n          // path not found\n          // eslint-disable-next-line @typescript-eslint/no-loop-func\n          pages.every(({ path }) => path !== catalogPath)\n        ) {\n          if (isDebug) logger.info(`Generating catalog ${catalogPath}`)\n\n          pathToBeGenerated.add(catalogPath)\n        }\n      }\n  })\n\n  await Promise.all(\n    Array.from(pathToBeGenerated)\n      .map((path) => decodeURI(path))\n      .map(async (path) => {\n        const [, basename = ''] = /\\/([^/]+)\\/?$/.exec(path) ?? []\n        const title = getTitleFromFilename(basename)\n\n        return createPage(app, {\n          frontmatter: {\n            title,\n            ...frontmatter(path),\n          },\n          content,\n          path,\n        })\n      }),\n  ).then((catalogPages) => {\n    app.pages.push(...catalogPages)\n  })\n}\n","import type { CatalogPluginLocaleConfig } from '../shared/index.js'\n\nexport const catalogLocales: CatalogPluginLocaleConfig = {\n  '/en/': {\n    title: 'Catalog',\n    empty: 'No catalog',\n  },\n\n  '/zh/': {\n    title: '目录',\n    empty: '暂无目录',\n  },\n\n  '/zh-tw/': {\n    title: '目錄',\n    empty: '暫無目錄',\n  },\n\n  '/de/': {\n    title: 'Katalog',\n    empty: 'Kein Katalog',\n  },\n\n  '/de-at/': {\n    title: 'Katalog',\n    empty: 'Kein Katalog',\n  },\n\n  '/vi/': {\n    title: 'Danh mục',\n    empty: 'Không có danh mục',\n  },\n\n  '/uk/': {\n    title: 'Каталог',\n    empty: 'Немає каталогу',\n  },\n\n  '/ru/': {\n    title: 'Каталог',\n    empty: 'Нет каталога',\n  },\n\n  '/br/': {\n    title: 'Catálogo',\n    empty: 'Sem catálogo',\n  },\n\n  '/pl/': {\n    title: 'Katalog',\n    empty: 'Brak katalogu',\n  },\n\n  '/sk/': {\n    title: 'Katalóg',\n    empty: 'Žiadny katalóg',\n  },\n\n  '/fr/': {\n    title: 'Catalogue',\n    empty: 'Pas de catalogue',\n  },\n\n  '/es/': {\n    title: 'Catálogo',\n    empty: 'Sin catálogo',\n  },\n\n  '/ja/': {\n    title: 'カタログ',\n    empty: 'カタログなし',\n  },\n\n  '/tr/': {\n    title: 'Katalog',\n    empty: 'Katalog yok',\n  },\n\n  '/ko/': {\n    title: '목차',\n    empty: '목차 없음',\n  },\n\n  '/fi/': {\n    title: 'Luettelo',\n    empty: 'Ei luetteloa',\n  },\n\n  '/hu/': {\n    title: 'Katalógus',\n    empty: 'Nincs katalógus',\n  },\n\n  '/id/': {\n    title: 'Katalog',\n    empty: 'Tidak ada katalog',\n  },\n\n  '/nl/': {\n    title: 'Catalogus',\n    empty: 'Geen catalogus',\n  },\n}\n","import { addViteSsrNoExternal, getLocaleConfig } from '@vuepress/helper'\nimport type { PluginFunction } from 'vuepress/core'\nimport { getDirname, path } from 'vuepress/utils'\nimport { generateCatalogPage } from './generateCatalogPage.js'\nimport { catalogLocales as defaultLocales } from './locales.js'\nimport { PLUGIN_NAME, logger } from './logger.js'\nimport type { CatalogPluginOptions } from './options.js'\n\nconst __dirname = getDirname(import.meta.url)\n\nexport const catalogPlugin =\n  (options: CatalogPluginOptions = {}): PluginFunction =>\n  (app) => {\n    if (app.env.isDebug) logger.info('Options:', options)\n\n    const { component, locales } = options\n\n    return {\n      name: PLUGIN_NAME,\n\n      define: (): Record<string, unknown> => ({\n        __CATALOG_LOCALES__: getLocaleConfig({\n          app,\n          name: PLUGIN_NAME,\n          default: defaultLocales,\n          config: locales,\n        }),\n      }),\n\n      onInitialized: (): Promise<void> => generateCatalogPage(app, options),\n\n      extendsBundlerOptions: (bundlerOptions: unknown): void => {\n        addViteSsrNoExternal(bundlerOptions, app, '@vuepress/helper')\n      },\n\n      ...(component\n        ? {}\n        : { clientConfigFile: path.join(__dirname, '../client/config.js') }),\n    }\n  }\n"],"names":["EN_PREPOSITION","getTitleFromFilename","filename","_all","match1","match2","word","index","PLUGIN_NAME","logger","Logger","generateCatalogPage","app","component","exclude","frontmatter","level","isDebug","pages","pathToBeGenerated","content","pagePath","pathLocale","catalogPath","pattern","path","basename","title","createPage","catalogPages","catalogLocales","__dirname","getDirname","catalogPlugin","options","locales","getLocaleConfig","defaultLocales","bundlerOptions","addViteSsrNoExternal"],"mappings":"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"}