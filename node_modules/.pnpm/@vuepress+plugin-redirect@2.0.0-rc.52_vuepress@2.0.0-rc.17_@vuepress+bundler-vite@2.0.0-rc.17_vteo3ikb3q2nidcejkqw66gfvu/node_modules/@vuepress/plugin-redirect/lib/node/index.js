import{Logger as P,removeEndingSlash as h,entries as m,removeLeadingSlash as g,isLinkHttp as R,isLinkAbsolute as b,deepAssign as z,fromEntries as p,isPlainObject as w,isArray as L,keys as S,isFunction as _,getRealPath as C,getLocaleConfig as E,addViteSsrNoExternal as j}from"@vuepress/helper";import{fs as s,path as f,colors as A,getDirname as D}from"vuepress/utils";import{createPage as F}from"vuepress/core";const M=async a=>{a.pages.every(({path:e})=>e!=="/")&&a.pages.push(await F(a,{path:"/",frontmatter:{title:"Home"},content:`Redirecting to the correct locale...
`}))},v="@vuepress/plugin-redirect",d=new P(v),B=({config:a,defaultBehavior:e,defaultLocale:c,localeFallback:n},t,i)=>`<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex">
  <title>Redirecting...</title>
  <script>
    const { hash, origin, pathname } = window.location;
    const routePath = pathname.substring(${i.length});
    const { languages } = window.navigator;
    const anchor = hash.substring(1);

    const config = ${JSON.stringify(a)};
    const availableLocales = ${JSON.stringify(t)};
    const defaultLocale = ${t.includes(c)?JSON.stringify(c):"availableLocales.pop()"};
    const defaultBehavior = ${JSON.stringify(e)}

    let matchedLocalePath = null;

    // get matched locale
    findLanguage:
      for (const lang of languages)
        for (const [localePath, langs] of Object.entries(config))
          if (langs.includes(lang)) {
${n?`            if (!availableLocales.includes(localePath))
              continue;
`:""}            matchedLocalePath = localePath;
            break findLanguage;
          }

    // default link
    const defaultLink = defaultLocale? \`\${origin}${h(i)}\${defaultLocale}\${routePath}\${anchor? \`#\${anchor}\`: ""}\`: null;

    // a locale matches
    if (matchedLocalePath) {
      const localeLink = \`\${origin}${h(i)}\${matchedLocalePath}\${routePath}\${anchor? \`#\${anchor}\`: ""}\`;

      if (availableLocales.includes(matchedLocalePath)) {
        location.href = localeLink;
      }
      // the page does not exist
      else {
        // locale homepage
        if (defaultBehavior === "homepage") {
          location.href = \`\${origin}${h(i)}\${matchedLocalePath}\`;
        }
        // default locale page
        else if (defaultBehavior === "defaultLocale" && defaultLink) {
          location.href = defaultLink;
        }
        // as is to get a 404 page of that locale
        else {
          location.href = localeLink;
        }
      }
    }
    // we have a default page
    else if (defaultLink) {
      location.href = defaultLink;
    }
    else {
      location.href = \`\${origin}${h(i)}/404.html\`;
    }
  <\/script>
</head>
<body>
  <p>Redirecting...</p>
</body>
</html>
`,T=async({dir:a,options:e,pages:c},n)=>{const t=c.filter(({pathLocale:o})=>o==="/").map(({path:o})=>o),i={};c.filter(({pathLocale:o})=>o!=="/").forEach(({path:o,pathLocale:l})=>{const r=o.replace(l,"/").replace(/\/$/,"/index.html");t.includes(r)||(i[r]??=[]).push(l)});const{succeed:$}=d.load("Generating locale redirect files");await Promise.all(m(i).map(async([o,l])=>{const r=a.dest(g(o));s.existsSync(r)||(await s.ensureDir(f.dirname(r)),await s.writeFile(r,B(n,l,e.base)))})),$()},O=a=>`<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex">
  <meta http-equiv="refresh" content="0; url=${a}">
  <link rel="canonical" href="${a}">
  <title>Redirecting...</title>
  <script>
    const anchor = window.location.hash.substring(1);
    location.href = \`${a}\${anchor? \`#\${anchor}\`: ""}\`;
  <\/script>
</head>
<body>
  <p>Redirecting...</p>
</body>
</html>
`,x=async({dir:a,options:e},c,n="")=>{const t=n?h(R(n)?n:`https://${n}`):"",{succeed:i}=d.load("Generating redirect files");await Promise.all(m(c).map(async([$,o])=>{const l=a.dest(g($));if(!s.existsSync(l)){const r=b(o)?`${t}${e.base}${g(o)}`:o;await s.ensureDir(f.dirname(l)),await s.writeFile(l,O(r))}})),i()},I=["defaultLocale","homepage","404"],N=(a,e)=>{const{locales:c}=a.options,n=z(p(m(c).filter(([t,{lang:i}])=>i?!0:(d.error(`Missing ${A.magenta("lang")} option for locale "${t}", this locale will be ignored!`),!1)).map(([t,{lang:i}])=>[t,[i]])),w(e.localeConfig)?p(m(e.localeConfig).map(([t,i])=>[t,L(i)?i:[i]])):{});return{config:n,autoLocale:e.autoLocale??!1,defaultLocale:e.defaultLocale||S(n).pop(),localeFallback:e.localeFallback??!0,defaultBehavior:e.defaultBehavior&&I.includes(e.defaultBehavior)?e.defaultBehavior:"defaultLocale"}},H=/#.*$/u,u=(a,e=!1)=>(e?a.replace(H,""):a).replace(/\/(?:README\.md)?$/i,"/index.html").replace(/(?:\.(?:md|html))?$/,".html"),V=(a,e)=>{const c=_(e.config)?e.config(a):w(e.config)?e.config:{};return{...p(a.pages.map(({frontmatter:n,path:t})=>L(n.redirectFrom)?n.redirectFrom.map(i=>[u(i,!0),t]):n.redirectFrom?[[u(n.redirectFrom,!0),t]]:[]).flat()),...p(m(c).map(([n,t])=>[u(n,!0),u(t)]))}},G=({frontmatter:a},e)=>{const{base:c}=e.options,{redirectTo:n}=a;if(n){const t=u(b(n)?`${c}${g(n)}`:n);(a.head??=[]).unshift(["script",{},`{const anchor = window.location.hash.substring(1);location.href=\`${t}\${anchor? \`#\${anchor}\`: ""}\`;}`])}},J={"/en/":{name:"English",hint:"Your primary language is $1, do you want to switch to it?",switch:"Switch to $1",cancel:"Cancel",remember:"Remember my choice"},"/zh/":{name:"简体中文",hint:"您的首选语言是 $1，是否切换到该语言？",switch:"切换到 $1",cancel:"取消",remember:"记住我的选择"},"/zh-tw/":{name:"繁體中文",hint:"您的首選語言是 $1，是否切換到該語言？",switch:"切換到 $1",cancel:"取消",remember:"記住我的選擇"},"/de/":{name:"Deutsch",hint:"Ihre bevorzugte Sprache ist $1, möchten Sie zu dieser wechseln?",switch:"Zu $1 wechseln",cancel:"Abbrechen",remember:"Meine Wahl merken"},"/de-at/":{name:"Deutsch (Österreich)",hint:"Ihre bevorzugte Sprache ist $1, möchten Sie zu dieser wechseln?",switch:"Zu $1 wechseln",cancel:"Abbrechen",remember:"Meine Wahl merken"},"/vi/":{name:"Tiếng Việt",hint:"Ngôn ngữ chính của bạn là $1, bạn có muốn chuyển sang nó?",switch:"Chuyển sang $1",cancel:"Hủy",remember:"Nhớ lựa chọn của tôi"},"/uk/":{name:"Українська",hint:"Вашою основною мовою є $1, чи бажаєте ви переключитися на неї?",switch:"Переключитися на $1",cancel:"Скасувати",remember:"Запам’ятати мій вибір"},"/ru/":{name:"Русский",hint:"Ваш основной язык - $1, вы хотите переключиться на него?",switch:"Переключиться на $1",cancel:"Отмена",remember:"Запомнить мой выбор"},"/br/":{name:"Português (Brasil)",hint:"A língua principal é $1, deseja mudar para ela?",switch:"Mudar para $1",cancel:"Cancelar",remember:"Lembrar minha escolha"},"/pl/":{name:"Polski",hint:"Twoim głównym językiem jest $1, czy chcesz przełączyć się na niego?",switch:"Przełącz na $1",cancel:"Anuluj",remember:"Zapamiętaj moje wybory"},"/sk/":{name:"Slovenčina",hint:"Vašou hlavnou jazykom je $1, chcete prepnúť naň?",switch:"Prepnúť na $1",cancel:"Zrušiť",remember:"Zapamätať si moju voľbu"},"/fr/":{name:"Français",hint:"Votre langue principale est $1, voulez-vous la changer ?",switch:"Changer pour $1",cancel:"Annuler",remember:"Se souvenir de mon choix"},"/tr/":{name:"Türkçe",hint:"Ana diliniz $1, ona geçmek ister misiniz?",switch:"$1'e geç",cancel:"İptal",remember:"Seçimimi hatırla"},"/fi/":{name:"Suomi",hint:"Pääkielenäsi on $1, haluatko vaihtaa siihen?",switch:"Vaihda $1:een",cancel:"Peruuta",remember:"Muista valintani"},"/hu/":{name:"Magyar",hint:"A fő nyelvét $1, szeretné váltani?",switch:"Váltás $1",cancel:"Mégse",remember:"Emlékezzen a választásomra"},"/id/":{name:"Bahasa Indonesia",hint:"Bahasa utama Anda adalah $1, apakah Anda ingin beralih ke sana?",switch:"Beralih ke $1",cancel:"Batal",remember:"Ingat pilihan saya"},"/nl/":{name:"Nederlands",hint:"Uw primaire taal is $1, wilt u overschakelen?",switch:"Overschakelen naar $1",cancel:"Annuleren",remember:"Onthoud mijn keuze"},"/ja/":{name:"日本語",hint:"あなたの主要な言語は $1 です。それに切り替えますか？",switch:"$1 に切り替える",cancel:"キャンセル",remember:"選択を記憶する"},"/ko/":{name:"한국어",hint:"당신의 기본 언어는 $1입니다. 그것으로 전환 하시겠습니까?",switch:"$1로 전환",cancel:"취소",remember:"내 선택 기억하기"},"/es/":{name:"Español",hint:"Su idioma principal es $1, ¿desea cambiarlo?",switch:"Cambiar a $1",cancel:"Cancelar",remember:"Recordar mi elección"},"/pt/":{name:"Português",hint:"Sua língua principal é $1, deseja mudar para ela?",switch:"Mudar para $1",cancel:"Cancelar",remember:"Lembrar minha escolha"}},{url:y}=import.meta,k=D(y),Z=(a={})=>e=>{e.env.isDebug&&d.info("Options:",a);const c=N(e,a);let n=null;return{name:v,alias:{"@vuepress/plugin-redirect/modal":a.switchLocale==="modal"?f.resolve(k,"../client/components/RedirectModal.js"):C("@vuepress/helper/noopComponent",y)},define:{__REDIRECT_CONFIG__:c,__REDIRECT_DIRECT__:a.switchLocale==="direct",__REDIRECT_MODAL__:a.switchLocale==="modal",__REDIRECT_LOCALES__:E({app:e,name:"redirect",config:a.locales,default:J})},extendsBundlerOptions:t=>{j(t,e,"@vuepress/helper")},extendsPage:t=>{G(t,e)},onInitialized:async()=>{n=V(e,a),e.env.isDebug&&d.info("Redirect Map:",n),a.autoLocale&&e.env.isDebug&&await M(e)},onPrepared:async()=>{await e.writeTemp("redirect/map.js",`export const redirectMap = ${e.env.isDev?JSON.stringify(n,null,2):"{}"};
`),e.env.isDev&&(n=null)},onGenerated:async()=>{await x(e,n),a.autoLocale&&await T(e,c)},clientConfigFile:f.join(k,"../client/config.js")}};export{Z as redirectPlugin};
//# sourceMappingURL=index.js.map
