import{search as O,getStoredFields as z,autoSuggest as C,loadJSONIndex as F}from"slimsearch";import T from"@temp/search-pro/index.js";import{entries as $}from"@vuepress/helper/client";const S=(e,o)=>{const i=e.toLowerCase(),s=o.toLowerCase(),t=[];let n=0,l=0;const r=(c,f=!1)=>{let u="";l===0?u=c.length>20?`… ${c.slice(-20)}`:c:f?u=c.length+l>100?`${c.slice(0,100-l)}… `:c:u=c.length>20?`${c.slice(0,20)} … ${c.slice(-20)}`:c,u&&t.push(u),l+=u.length,f||(t.push(["mark",o]),l+=o.length,l>=100&&t.push(" …"))};let p=i.indexOf(s,n);if(p===-1)return null;for(;p>=0;){const c=p+s.length;if(r(e.slice(n,p)),n=c,l>100)break;p=i.indexOf(s,n)}return l<100&&r(e.slice(n),!0),t},b=(e,o)=>o.contents.reduce((i,[,s])=>i+s,0)-e.contents.reduce((i,[,s])=>i+s,0),w=(e,o)=>Math.max(...o.contents.map(([,i])=>i))-Math.max(...e.contents.map(([,i])=>i)),M=(e,o,i={})=>{const s={};return O(o,e,{boost:{h:2,t:1,c:4},prefix:!0,...i}).forEach(t=>{const{id:n,terms:l,score:r}=t,p=n.includes("@"),c=n.includes("#"),[f,u]=n.split(/[#@]/),g=Number(f),m=l.sort((h,a)=>h.length-a.length).filter((h,a)=>l.slice(a+1).every(d=>!d.includes(h))),{contents:y}=s[g]??={title:"",contents:[]};if(p)y.push([{type:"customField",id:g,index:u,display:m.map(h=>t.c.map(a=>S(a,h))).flat().filter(h=>h!==null)},r]);else{const h=m.map(a=>S(t.h,a)).filter(a=>a!==null);if(h.length&&y.push([{type:c?"heading":"title",id:g,...c&&{anchor:u},display:h},r]),"t"in t)for(const a of t.t){const d=m.map(x=>S(a,x)).filter(x=>x!==null);d.length&&y.push([{type:"text",id:g,...c&&{anchor:u},display:d},r])}}}),$(s).sort(([,t],[,n])=>SEARCH_PRO_SORT_STRATEGY==="total"?b(t,n):w(t,n)).map(([t,{title:n,contents:l}])=>{if(!n){const r=z(o,t);r&&(n=r.h)}return{title:n,contents:l.map(([r])=>r)}})},R=(e,o,i={})=>{const s=C(o,e,{fuzzy:.2,maxFuzzy:3,...i}).map(({suggestion:t})=>t);return e.includes(" ")?s:s.filter(t=>!t.includes(" "))};self.onmessage=async({data:{type:e="all",query:o,locale:i,options:s,id:t}})=>{const{default:n}=await T[i??"/"](),l=F(n,{fields:["h","t","c"],storeFields:["h","t","c"]});e==="suggest"?self.postMessage([e,t,R(o,l,s)]):e==="search"?self.postMessage([e,t,M(o,l,s)]):self.postMessage({suggestions:[e,t,R(o,l,s)],results:[e,t,M(o,l,s)]})};
//# sourceMappingURL=index.js.map
