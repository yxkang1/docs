import{defineComponent as m,ref as p,computed as d,h as n,nextTick as O,onMounted as E}from"vue";import{RenderDefault as T}from"vuepress-shared/client";import{usePageFrontmatter as k,usePageData as w}from"vuepress/client";import{L as _}from"../../icons-BBxJRXot.js";import{u as x,a as G,b as H}from"../../usePure-B1lKNvWK.js";import{useStorage as b,useSessionStorage as h}from"@vueuse/core";import{compareSync as f}from"bcrypt-ts/browser";import{F as K}from"../../FadeSlideY-DXWaZ1LE.js";import{isPlainObject as R,keys as V,startsWith as j}from"@vuepress/helper/client";import"@vuepress/plugin-theme-data/client";var g=m({name:"PasswordModal",props:{full:Boolean},emits:["verify"],setup(l,{emit:a}){const r=k(),s=x(),o=p(""),e=p(!1),t=p(!1),u=d(()=>s.value.encryptLocales);let i=null;const c=()=>{i&&clearTimeout(i),e.value=!1,a("verify",o.value,t.value),O().then(()=>{e.value=!0,i=setTimeout(()=>{e.value=!1},1e3)})};return()=>n("div",{class:["vp-decrypt-layer",{expand:l.full||r.value.home}]},n("div",{class:"vp-decrypt-modal"},[n("div",{class:["vp-decrypt-hint",{tried:e.value}]},e.value?u.value.errorHint:n(_,{"aria-label":u.value.iconLabel})),n("div",{class:"vp-decrypt-input"},[n("input",{type:"password",value:o.value,placeholder:u.value.placeholder,onInput:({target:v})=>{o.value=v.value},onKeydown:({key:v})=>{v==="Enter"&&c()}})]),n("div",{class:"vp-remember-password"},[n("input",{id:"remember-password",type:"checkbox",value:t.value,onChange:()=>t.value=!t.value}),n("label",{for:"remember-password"},u.value.remember)]),n("button",{type:"button",class:"vp-decrypt-submit",onClick:()=>c()},"OK")]))}});const P=()=>{const l=G();return d(()=>l.value.encrypt||{})},D="VUEPRESS_HOPE_GLOBAL_TOKEN",C=()=>{const l=P(),a=b(D,""),r=h(D,""),s=d(()=>{const{global:e=!1,admin:t=[]}=l.value;return e&&t.length>0}),o=d(()=>{if(s.value){if(a.value)return l.value.admin.some(e=>f(a.value,e));if(r.value)return l.value.admin.some(e=>f(r.value,e))}return!1});return{isEncrypted:s,isDecrypted:o,validate:(e,t=!1)=>{(t?a:r).value=e}}},y=(l="",a)=>!!l&&f(l,a),S="VUEPRESS_HOPE_PATH_TOKEN",F=()=>{const l=w(),a=P(),r=b(S,{}),s=h(S,{}),o=t=>R(a.value.config)?V(a.value.config).filter(u=>j(decodeURI(t),u)).sort((u,i)=>i.length-u.length):[],e=t=>{const u=o(t);if(u.length>0){const{config:i={}}=a.value;return{isEncrypted:!0,isDecrypted:u.some(c=>r.value[c]&&i[c].some(v=>y(r.value[c],v))||s.value[c]&&i[c].some(v=>y(s.value[c],v)))}}return{isDecrypted:!1,isEncrypted:!1}};return{status:d(()=>e(l.value.path)),getStatus:e,validate:(t,u=!1)=>{const{config:i={}}=a.value,c=o(l.value.path);for(const v of c)if(i[v].filter(L=>y(t,L))){(u?r:s).value[v]=t;break}}}};var I=m({name:"GlobalEncrypt",slots:Object,setup(l,{slots:a}){const{isDecrypted:r,isEncrypted:s,validate:o}=C(),e=H(),t=p(!1);return E(()=>{t.value=!0}),()=>n(e.value?T:K,()=>s.value?t.value?r.value?a.default():n(g,{full:!0,onVerify:o}):null:a.default())}}),M=m({name:"LocalEncrypt",slots:Object,setup(l,{slots:a}){const{status:r,validate:s}=F(),o=p(!1);return E(()=>{o.value=!0}),()=>{const{isEncrypted:e,isDecrypted:t}=r.value;return e?o.value?t?a.default():n(g,{full:!0,onVerify:s}):null:a.default()}}});export{I as GlobalEncrypt,M as LocalEncrypt};
//# sourceMappingURL=export.js.map
