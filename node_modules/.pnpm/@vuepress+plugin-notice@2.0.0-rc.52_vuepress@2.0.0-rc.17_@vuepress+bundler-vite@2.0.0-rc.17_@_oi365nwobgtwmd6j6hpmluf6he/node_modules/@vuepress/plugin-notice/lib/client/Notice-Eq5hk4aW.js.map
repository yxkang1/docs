{"version":3,"file":"Notice-Eq5hk4aW.js","sources":["../../src/client/components/CloseIcon.ts","../../src/client/components/Notice.ts"],"sourcesContent":["import type { FunctionalComponent } from 'vue'\nimport { h } from 'vue'\n\nexport const CloseIcon: FunctionalComponent = () =>\n  h(\n    'svg',\n    {\n      'xmlns': 'http://www.w3.org/2000/svg',\n      'class': 'close-icon',\n      'viewBox': '0 0 1024 1024',\n      'fill': 'currentColor',\n      'aria-label': 'close icon',\n    },\n    h('path', {\n      d: 'm925.468 822.294-303.27-310.288L925.51 201.674c34.683-27.842 38.3-75.802 8.122-107.217-30.135-31.37-82.733-34.259-117.408-6.463L512.001 399.257 207.777 87.993C173.1 60.197 120.504 63.087 90.369 94.456c-30.179 31.415-26.561 79.376 8.122 107.217L401.8 512.005l-303.27 310.29c-34.724 27.82-38.34 75.846-8.117 107.194 30.135 31.437 82.729 34.327 117.408 6.486L512 624.756l304.177 311.22c34.68 27.84 87.272 24.95 117.408-6.487 30.223-31.348 26.56-79.375-8.118-107.195z',\n    }),\n  )\n\nCloseIcon.displayName = 'CloseIcon'\n","import { isLinkAbsolute, isLinkHttp, startsWith } from '@vuepress/helper/client'\nimport type { PropType } from 'vue'\nimport {\n  TransitionGroup,\n  computed,\n  defineComponent,\n  h,\n  onMounted,\n  ref,\n  watch,\n} from 'vue'\nimport { useRoutePath, useRouter } from 'vuepress/client'\nimport type { NoticeItemOptions } from '../../shared/index.js'\nimport { CloseIcon } from './CloseIcon.js'\n\nimport '../styles/notice.css'\n\ntype NoticeClientOption = Omit<NoticeItemOptions, 'key'> & {\n  noticeKey?: string\n} & ({ match: string } | { path: string })\n\nexport const Notice = defineComponent({\n  name: 'Notice',\n\n  props: {\n    /**\n     * Notice locales settings\n     *\n     * 通知的多语言设置\n     */\n    config: {\n      type: Array as PropType<NoticeClientOption[]>,\n      required: true,\n    },\n  },\n\n  setup(props) {\n    const router = useRouter()\n    const routePath = useRoutePath()\n\n    const isVisible = ref(false)\n\n    const matchedConfig = computed(() => {\n      const option = props.config.find((item) =>\n        'match' in item\n          ? new RegExp(item.match).test(routePath.value)\n          : startsWith(routePath.value, item.path),\n      )\n\n      if (!option) return null\n\n      const {\n        noticeKey,\n        actions = [],\n        title = '',\n        content = '',\n        ...rest\n      } = option\n\n      return {\n        ...rest,\n        actions,\n        title,\n        content,\n        key: noticeKey ? `notice-${noticeKey}` : `notice:${title}${content}`,\n      }\n    })\n\n    const closeModal = (): void => {\n      isVisible.value = false\n\n      if (matchedConfig.value) {\n        ;(matchedConfig.value.showOnce ? localStorage : sessionStorage).setItem(\n          matchedConfig.value.key,\n          'true',\n        )\n      }\n    }\n\n    const footerAction = (link?: string): void => {\n      if (link)\n        if (isLinkAbsolute(link)) router.push(link)\n        else if (isLinkHttp(link)) window.open(link)\n\n      closeModal()\n    }\n\n    onMounted(() => {\n      watch(\n        matchedConfig,\n        () => {\n          if (matchedConfig.value) {\n            const hasBeenClosed = (\n              matchedConfig.value.showOnce ? localStorage : sessionStorage\n            ).getItem(matchedConfig.value.key)\n\n            isVisible.value = !hasBeenClosed\n          }\n        },\n        { immediate: true },\n      )\n    })\n\n    return () =>\n      h(TransitionGroup, { name: 'notice-fade' }, () =>\n        matchedConfig.value && isVisible.value\n          ? [\n              matchedConfig.value.fullscreen\n                ? h('div', {\n                    key: 'mask',\n                    class: 'vp-notice-mask',\n                    onClick: () => {\n                      if (!matchedConfig.value!.confirm) closeModal()\n                    },\n                  })\n                : null,\n              h(\n                'div',\n                {\n                  key: 'popup',\n                  class: [\n                    'vp-notice-wrapper',\n                    { fullscreen: matchedConfig.value.fullscreen },\n                  ],\n                },\n                [\n                  h('header', { class: 'vp-notice-title' }, [\n                    matchedConfig.value.confirm\n                      ? null\n                      : h(CloseIcon, { onClick: closeModal }),\n                    h('span', { innerHTML: matchedConfig.value.title }),\n                  ]),\n                  h('div', {\n                    class: 'vp-notice-content',\n                    innerHTML: matchedConfig.value.content,\n                  }),\n                  h(\n                    'div',\n                    { class: 'vp-notice-footer' },\n                    matchedConfig.value.actions.map(\n                      ({ text, link, type = '' }) =>\n                        h('button', {\n                          type: 'button',\n                          class: ['vp-notice-footer-action', type],\n                          onClick: () => {\n                            footerAction(link)\n                          },\n                          innerHTML: text,\n                        }),\n                    ),\n                  ),\n                ],\n              ),\n            ]\n          : [],\n      )\n  },\n})\n"],"names":["CloseIcon","h","Notice","defineComponent","props","router","useRouter","routePath","useRoutePath","isVisible","ref","matchedConfig","computed","option","item","startsWith","noticeKey","actions","title","content","rest","closeModal","footerAction","link","isLinkAbsolute","isLinkHttp","onMounted","watch","hasBeenClosed","TransitionGroup","text","type"],"mappings":"sSAGO,MAAMA,EAAiC,IAC5CC,EACE,MACA,CACE,MAAS,6BACT,MAAS,aACT,QAAW,gBACX,KAAQ,eACR,aAAc,YAChB,EACAA,EAAE,OAAQ,CACR,EAAG,idACL,CAAC,CACH,EAEFD,EAAU,YAAc,YCGX,MAAAE,EAASC,EAAgB,CACpC,KAAM,SAEN,MAAO,CAML,OAAQ,CACN,KAAM,MACN,SAAU,EACZ,CACF,EAEA,MAAMC,EAAO,CACX,MAAMC,EAASC,EACTC,EAAAA,EAAYC,IAEZC,EAAYC,EAAI,EAAK,EAErBC,EAAgBC,EAAS,IAAM,CACnC,MAAMC,EAAST,EAAM,OAAO,KAAMU,GAChC,UAAWA,EACP,IAAI,OAAOA,EAAK,KAAK,EAAE,KAAKP,EAAU,KAAK,EAC3CQ,EAAWR,EAAU,MAAOO,EAAK,IAAI,CAC3C,EAEA,GAAI,CAACD,EAAQ,OAAO,KAEpB,KAAM,CACJ,UAAAG,EACA,QAAAC,EAAU,CAAA,EACV,MAAAC,EAAQ,GACR,QAAAC,EAAU,GACV,GAAGC,CACL,EAAIP,EAEJ,MAAO,CACL,GAAGO,EACH,QAAAH,EACA,MAAAC,EACA,QAAAC,EACA,IAAKH,EAAY,UAAUA,CAAS,GAAK,UAAUE,CAAK,GAAGC,CAAO,EACpE,CACF,CAAC,EAEKE,EAAa,IAAY,CAC7BZ,EAAU,MAAQ,GAEdE,EAAc,QACdA,EAAc,MAAM,SAAW,aAAe,gBAAgB,QAC9DA,EAAc,MAAM,IACpB,MACF,CAEJ,EAEMW,EAAgBC,GAAwB,CACxCA,IACEC,EAAeD,CAAI,EAAGlB,EAAO,KAAKkB,CAAI,EACjCE,EAAWF,CAAI,GAAG,OAAO,KAAKA,CAAI,GAE7CF,EAAW,CACb,EAEA,OAAAK,EAAU,IAAM,CACdC,EACEhB,EACA,IAAM,CACJ,GAAIA,EAAc,MAAO,CACvB,MAAMiB,GACJjB,EAAc,MAAM,SAAW,aAAe,gBAC9C,QAAQA,EAAc,MAAM,GAAG,EAEjCF,EAAU,MAAQ,CAACmB,CACrB,CACF,EACA,CAAE,UAAW,EAAK,CACpB,CACF,CAAC,EAEM,IACL3B,EAAE4B,EAAiB,CAAE,KAAM,aAAc,EAAG,IAC1ClB,EAAc,OAASF,EAAU,MAC7B,CACEE,EAAc,MAAM,WAChBV,EAAE,MAAO,CACP,IAAK,OACL,MAAO,iBACP,QAAS,IAAM,CACRU,EAAc,MAAO,SAASU,EACrC,CAAA,CACF,CAAC,EACD,KACJpB,EACE,MACA,CACE,IAAK,QACL,MAAO,CACL,oBACA,CAAE,WAAYU,EAAc,MAAM,UAAW,CAC/C,CACF,EACA,CACEV,EAAE,SAAU,CAAE,MAAO,iBAAkB,EAAG,CACxCU,EAAc,MAAM,QAChB,KACAV,EAAED,EAAW,CAAE,QAASqB,CAAW,CAAC,EACxCpB,EAAE,OAAQ,CAAE,UAAWU,EAAc,MAAM,KAAM,CAAC,CACpD,CAAC,EACDV,EAAE,MAAO,CACP,MAAO,oBACP,UAAWU,EAAc,MAAM,OACjC,CAAC,EACDV,EACE,MACA,CAAE,MAAO,kBAAmB,EAC5BU,EAAc,MAAM,QAAQ,IAC1B,CAAC,CAAE,KAAAmB,EAAM,KAAAP,EAAM,KAAAQ,EAAO,EAAG,IACvB9B,EAAE,SAAU,CACV,KAAM,SACN,MAAO,CAAC,0BAA2B8B,CAAI,EACvC,QAAS,IAAM,CACbT,EAAaC,CAAI,CACnB,EACA,UAAWO,CACb,CAAC,CACL,CACF,CACF,CACF,CACF,EACA,CACN,CAAA,CACJ,CACF,CAAC"}