{"version":3,"file":"index.js","sources":["../../src/client/composables/setupCopyright.ts"],"sourcesContent":["import type { ExactLocaleConfig } from '@vuepress/helper/client'\nimport {\n  isLinkHttp,\n  isPlainObject,\n  isString,\n  removeEndingSlash,\n  useLocaleConfig,\n} from '@vuepress/helper/client'\nimport { useEventListener } from '@vueuse/core'\nimport { computed, onMounted, watchEffect } from 'vue'\nimport { usePageData, usePageFrontmatter } from 'vuepress/client'\nimport type {\n  CopyrightPluginFrontmatter,\n  CopyrightPluginLocaleData,\n  CopyrightPluginPageData,\n} from '../../shared/index.js'\nimport type { CopyrightPluginClientOptions } from '../typings.js'\n\nexport const setupCopyright = (\n  options: CopyrightPluginClientOptions,\n  locales: ExactLocaleConfig<CopyrightPluginLocaleData>,\n): void => {\n  const locale = useLocaleConfig(locales)\n  const frontmatter = usePageFrontmatter<CopyrightPluginFrontmatter>()\n  const page = usePageData<CopyrightPluginPageData>()\n\n  const enabled = computed(\n    () =>\n      Boolean(frontmatter.value.copy) ||\n      (frontmatter.value.copy !== false && options.global),\n  )\n\n  const frontmatterOptions = computed(() =>\n    isPlainObject(frontmatter.value.copy) ? frontmatter.value.copy : null,\n  )\n\n  const disableCopy = computed(\n    () => frontmatterOptions.value?.disableCopy ?? options.disableCopy ?? false,\n  )\n\n  const disableSelection = computed(() =>\n    enabled.value\n      ? (frontmatterOptions.value?.disableSelection ??\n        options.disableSelection ??\n        false)\n      : false,\n  )\n\n  const maxLength = computed(() =>\n    enabled.value\n      ? (frontmatterOptions.value?.maxLength ?? options.maxLength ?? 0)\n      : 0,\n  )\n\n  const triggerLength = computed(\n    () =>\n      frontmatterOptions.value?.triggerLength ?? options.triggerLength ?? 100,\n  )\n\n  const getLink = (canonical?: string): string =>\n    canonical\n      ? `${removeEndingSlash(\n          isLinkHttp(canonical) ? canonical : `https://${canonical}`,\n        )}${page.value.path}`\n      : window.location.href\n\n  const getCopyrightContent = (\n    authorInfo?: string,\n    licenseInfo?: string,\n  ): string => {\n    const { author, license, link } = locale.value\n\n    return [\n      authorInfo ? author.replace(':author', authorInfo) : '',\n      licenseInfo ? license.replace(':license', licenseInfo) : '',\n      link.replace(':link', getLink(options.canonical)),\n    ]\n      .filter((item) => item)\n      .join('\\n')\n  }\n\n  const getCopyright = (): string => {\n    if (isString(page.value.copyright))\n      return page.value.copyright.replace(':link', getLink())\n\n    const { author, license } = page.value.copyright ?? {}\n\n    return getCopyrightContent(\n      author ?? options.author,\n      license ?? options.license,\n    )\n  }\n\n  const onCopy = (event: ClipboardEvent): void => {\n    const selection = getSelection()\n\n    if (selection) {\n      const textRange = selection.getRangeAt(0)\n\n      if (enabled.value) {\n        const textLength = textRange.toString().length\n\n        if (\n          disableCopy.value ||\n          (maxLength.value && textLength > maxLength.value)\n        ) {\n          event.preventDefault()\n          return\n        }\n\n        if (textLength >= triggerLength.value) {\n          event.preventDefault()\n\n          const copyright = getCopyright()\n          const node = document.createElement('div')\n\n          node.appendChild(selection.getRangeAt(0).cloneContents())\n\n          if (event.clipboardData) {\n            event.clipboardData.setData(\n              'text/html',\n              `${node.innerHTML}<hr><div class=\"copyright\">${copyright.replace(\n                /\\\\n/g,\n                '<br>',\n              )}</div>`,\n            )\n            event.clipboardData.setData(\n              'text/plain',\n              `${\n                selection.getRangeAt(0).cloneContents().textContent || ''\n              }\\n------\\n${copyright}`,\n            )\n          }\n        }\n      }\n    }\n  }\n\n  onMounted(() => {\n    const appElement = document.querySelector<HTMLDivElement>('#app')!\n\n    useEventListener(appElement, 'copy', onCopy)\n\n    watchEffect(() => {\n      appElement.style.userSelect = disableSelection.value ? 'none' : 'auto'\n    })\n  })\n}\n"],"names":["setupCopyright","options","locales","locale","useLocaleConfig","frontmatter","usePageFrontmatter","page","usePageData","enabled","computed","frontmatterOptions","isPlainObject","disableCopy","disableSelection","maxLength","triggerLength","getLink","canonical","removeEndingSlash","isLinkHttp","getCopyrightContent","authorInfo","licenseInfo","author","license","link","item","getCopyright","isString","onCopy","event","selection","textRange","textLength","copyright","node","onMounted","appElement","useEventListener","watchEffect"],"mappings":"uTAkBO,MAAMA,EAAiB,CAC5BC,EACAC,IACS,CACT,MAAMC,EAASC,EAAgBF,CAAO,EAChCG,EAAcC,IACdC,EAAOC,EAEPC,EAAAA,EAAUC,EACd,IACE,CAAA,CAAQL,EAAY,MAAM,MACzBA,EAAY,MAAM,OAAS,IAASJ,EAAQ,MACjD,EAEMU,EAAqBD,EAAS,IAClCE,EAAcP,EAAY,MAAM,IAAI,EAAIA,EAAY,MAAM,KAAO,IACnE,EAEMQ,EAAcH,EAClB,IAAMC,EAAmB,OAAO,aAAeV,EAAQ,aAAe,EACxE,EAEMa,EAAmBJ,EAAS,IAChCD,EAAQ,MACHE,EAAmB,OAAO,kBAC3BV,EAAQ,kBACR,GACA,EACN,EAEMc,EAAYL,EAAS,IACzBD,EAAQ,MACHE,EAAmB,OAAO,WAAaV,EAAQ,WAAa,EAC7D,CACN,EAEMe,EAAgBN,EACpB,IACEC,EAAmB,OAAO,eAAiBV,EAAQ,eAAiB,GACxE,EAEMgB,EAAWC,GACfA,EACI,GAAGC,EACDC,EAAWF,CAAS,EAAIA,EAAY,WAAWA,CAAS,EAC1D,CAAC,GAAGX,EAAK,MAAM,IAAI,GACnB,OAAO,SAAS,KAEhBc,EAAsB,CAC1BC,EACAC,IACW,CACX,KAAM,CAAE,OAAAC,EAAQ,QAAAC,EAAS,KAAAC,CAAK,EAAIvB,EAAO,MAEzC,MAAO,CACLmB,EAAaE,EAAO,QAAQ,UAAWF,CAAU,EAAI,GACrDC,EAAcE,EAAQ,QAAQ,WAAYF,CAAW,EAAI,GACzDG,EAAK,QAAQ,QAAST,EAAQhB,EAAQ,SAAS,CAAC,CAClD,EACG,OAAQ0B,GAASA,CAAI,EACrB,KAAK;AAAA,CAAI,CACd,EAEMC,EAAe,IAAc,CACjC,GAAIC,EAAStB,EAAK,MAAM,SAAS,EAC/B,OAAOA,EAAK,MAAM,UAAU,QAAQ,QAASU,EAAQ,CAAC,EAExD,KAAM,CAAE,OAAAO,EAAQ,QAAAC,CAAQ,EAAIlB,EAAK,MAAM,WAAa,CAAA,EAEpD,OAAOc,EACLG,GAAUvB,EAAQ,OAClBwB,GAAWxB,EAAQ,OACrB,CACF,EAEM6B,EAAUC,GAAgC,CAC9C,MAAMC,EAAY,aAElB,EAAA,GAAIA,EAAW,CACb,MAAMC,EAAYD,EAAU,WAAW,CAAC,EAExC,GAAIvB,EAAQ,MAAO,CACjB,MAAMyB,EAAaD,EAAU,SAAW,EAAA,OAExC,GACEpB,EAAY,OACXE,EAAU,OAASmB,EAAanB,EAAU,MAC3C,CACAgB,EAAM,eAAe,EACrB,MACF,CAEA,GAAIG,GAAclB,EAAc,MAAO,CACrCe,EAAM,eAAA,EAEN,MAAMI,EAAYP,EAAa,EACzBQ,EAAO,SAAS,cAAc,KAAK,EAEzCA,EAAK,YAAYJ,EAAU,WAAW,CAAC,EAAE,cAAe,CAAA,EAEpDD,EAAM,gBACRA,EAAM,cAAc,QAClB,YACA,GAAGK,EAAK,SAAS,8BAA8BD,EAAU,QACvD,OACA,MACF,CAAC,QACH,EACAJ,EAAM,cAAc,QAClB,aACA,GACEC,EAAU,WAAW,CAAC,EAAE,cAAc,EAAE,aAAe,EACzD;AAAA;AAAA,EAAaG,CAAS,EACxB,EAEJ,CACF,CACF,CACF,EAEAE,EAAU,IAAM,CACd,MAAMC,EAAa,SAAS,cAA8B,MAAM,EAEhEC,EAAiBD,EAAY,OAAQR,CAAM,EAE3CU,EAAY,IAAM,CAChBF,EAAW,MAAM,WAAaxB,EAAiB,MAAQ,OAAS,MAClE,CAAC,CACH,CAAC,CACH"}